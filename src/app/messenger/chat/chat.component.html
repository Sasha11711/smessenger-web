<div class="chat">
  <app-header class="chat-header" [leftButton]="{imageURL: 'assets/back_icon.svg', event: onChatUnselected}"
              [rightButtons]="[{imageURL: 'assets/settings_icon.svg', event: onSettingsToggled}]">
    <h1>{{chat.title}}</h1>
  </app-header>
  <div class="message-list">
    <button *ngIf="page" class="center button-primary" (click)="resetPage()">Reset</button>
    <app-message-item class="message-item" *ngFor="let message of messages"
                      [message]="message" [isAuthor]="message.author.id == user.id"
                      [isBlocked]="isBlocked(message.author)"
                      (contextmenu)="enableContextMenu($event, message)"/>
    <button *ngIf="!isLastPage" class="center button-primary" (click)="nextPage()">Load more...</button>
  </div>
  <form *ngIf="!editMessageItem" class="message-form" (ngSubmit)="onSubmit()" [formGroup]="messageForm">
    <div>
      <input class="file-input" type="file" accept=".png" name="embed"
             (change)="setEmbed($event)" #fileInput>
      <a class="button-image" (click)="fileInput.click()">
        <img [ngSrc]="embedURL??'assets/add_image_icon.svg'" alt="embed" width="60" height="60"/>
      </a>
    </div>
    <input class="message-input" type="text" placeholder="Enter message" formControlName="text"/>
    <button type="submit" class="button-image" [disabled]="messageForm.invalid || messageForm.disabled">
      <img ngSrc="assets/send_icon.svg" alt="send" width="60" height="60"/>
    </button>
  </form>
  <form *ngIf="editMessageItem" class="message-form" (ngSubmit)="onEditSubmit()" [formGroup]="editMessageForm">
    <a class="button-image" (click)="cancelEditMessage()">
      <img ngSrc="assets/back_icon.svg" alt="back" width="60" height="60"/>
    </a>
    <input class="message-input" type="text" [placeholder]="editMessageItem.text??''"
           formControlName="newText"/>
    <button type="submit" class="button-image" [disabled]="editMessageForm.invalid || editMessageForm.disabled">
      <img ngSrc="assets/send_icon.svg" alt="send" width="60" height="60"/>
    </button>
  </form>
</div>
<div *ngIf="contextMenuComponent">
  <app-context-menu [x]="contextMenuComponent.x" [y]="contextMenuComponent.y"
                    [buttons]="contextMenuComponent.buttons" [title]="contextMenuComponent.title"/>
</div>
